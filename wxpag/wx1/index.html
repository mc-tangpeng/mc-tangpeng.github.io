<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=640,user-scalable=no,target-densityDpi=device-dpi">
	<style type="text/css">
	* {margin: 0;padding: 0}
	html {overflow: hidden;}
	body{ font-family:Tahoma,Arial,Roboto,"Droid Sans","Helvetica Neue","Droid Sans Fallback","Heiti SC",sans-self;}
	li{ list-style:none;}
	img {display: block;}
	#main {position:relative;width:640px;height: auto;overflow: hidden;}
	#list {width: 100%;height: 100%; -webkit-perspective : 800; perspective : 800; list-style: none;}
	#list > li {position: absolute;left: 0;top: 0;z-index:5;width: 100%;height: 100%;display: none;-webkit-transform-origin : bottom;overflow: hidden;}
	#list > li.active {z-index: 6}
	#list > li:nth-of-type(1) {display: block;}
	#list > li img:nth-of-type(3){ position:absolute; opacity:0;}
	#list > li img:nth-of-type(3).active{ -webkit-animation:2s infinite title; animation:2s infinite title;}
	#list > li:nth-of-type(1) img:nth-of-type(3){ left:90px; top:530px;}
	#list > li:nth-of-type(2) img:nth-of-type(3){ left:153px; top:495px;}
	#list > li:nth-of-type(3) img:nth-of-type(3){ left:223px; top:709px;}
	#list > li:nth-of-type(4) img:nth-of-type(3){ left:153px; top:523px;}
	#list > li:nth-of-type(5) img:nth-of-type(3){ left:195px; top:733px;}
	#list > li:nth-of-type(6) img:nth-of-type(3){ left:49px; top:523px;}
	#list > li:nth-of-type(7) img:nth-of-type(3){ left:237px; top:530px;}
	#list > li:nth-of-type(8) img:nth-of-type(3){ left:231px; top:523px;}
	@-webkit-keyframes title{
		0%{ -webkit-transform:scale(1); opacity:0;}
		50%{ -webkit-transform:scale(1); opacity:0.5;}
		100%{ -webkit-transform:scale(1.2); opacity:0;}
	}
	@keyframes title{
		0%{ transform:scale(1); opacity:0;}
		50%{ transform:scale(1); opacity:0.5;}
		100%{ transform:scale(1.2); opacity:0;}
	}
	#c1 {position: absolute;left:0;top:0;z-index: 8;}
	
	#beginEffect {position: absolute;z-index: 9;width: 100%;height: 100%}
	#sun  {position: absolute;left: 46%;top: 20%;margin-left: -50px;width: 100px;height: 100px;background: url(img/sun.png) no-repeat;background-size: cover;-webkit-animation:1s infinite flash linear;animation:1s infinite flash linear;}
	@-webkit-keyframes flash {
		0% {opacity: 0.4;;}
		50% {opacity: 1;;}
		100% {opacity: 0.4;;}
	}
	@keyframes flash {
		0% {opacity: 0.4;;}
		50% {opacity: 1;;}
		100% {opacity: 0.4;;}
	}
	#text1 {position: absolute;left: 50%;top: 40%;margin-left: -174px; width: 348px;height: 200px;background: url(img/t1.png) no-repeat;}
	#text2 {position: absolute;left: 50%;top: 40%;margin-left: -209px; width:418px;height: 390px;background: url(img/t2.png) no-repeat;opacity: 0;}
	.lx img {position: absolute;-webkit-transform-origin:left;transform-origin:left;}
	.lx img:nth-of-type(1){ left:500px; top:400px; height:20px; -webkit-animation:4s -3s infinite liuxing linear; animation:3s infinite liuxing linear;}
	.lx img:nth-of-type(2){ left:300px; top:200px; height:10px; -webkit-animation:5s infinite liuxing linear; animation:5s infinite liuxing linear;}
	.lx img:nth-of-type(3){ left:400px; top:300px; height:5px; -webkit-animation:2s -2s infinite liuxing linear; animation:2s infinite liuxing linear;}
	.lx img:nth-of-type(4){ left:500px; top:600px; height:15px; -webkit-animation:7s -1s infinite liuxing linear; animation:7s infinite liuxing linear;}
	@-webkit-keyframes liuxing{
		0%{-webkit-transform:rotate(-45deg) translate(0,0) scaleX(0.5) ; opacity: 0}
		40%{-webkit-transform:rotate(-45deg) translate(-200px,0) scaleX(1) ; opacity:1 }
		100%{-webkit-transform:rotate(-45deg) translate(-500px,0) scaleX(0);opacity: 0}
	}
	@keyframes liuxing{
		0%{transform:rotate(-45deg) translate(0,0) scaleX(0.5) ; opacity: 0}
		40%{transform:rotate(-45deg) translate(-200px,0) scaleX(1) ; opacity:1 }
		100%{transform:rotate(-45deg) translate(-500px,0) scaleX(0);opacity: 0}
	}
	#arrow {position:absolute;z-index:7;left:50%;bottom:15px;margin-left:-30px;width: 60px;height: 50px;text-align: center;}
	#arrow div { margin : 0 auto; width: 28px; height: 16px; background: url(img/arr.png) no-repeat;-webkit-animation : arrow 1s infinite linear;animation : arrow 1s infinite linear;}
	#arrow span {font-size: 30px;}
	@-webkit-keyframes arrow{
		0%{opacity: 0;-webkit-transform: translate(0,0);}
		60%{opacity: 1;-webkit-transform: translate(0,-20px);}
		100%{opacity: 0;-webkit-transform: translate(0,-30px);}
	}
	@keyframes arrow{
		0%{opacity: 0;transform: translate(0,0);}
		60%{opacity: 1;transform: translate(0,-20px);}
		100%{opacity: 0;transform: translate(0,-30px);}
	}
	#music {position:absolute;right:20px;bottom:15px;z-index:7;width: 40px;height: 40px;background: url(img/musicoff.gif) no-repeat;background-size:cover }
	#music.active {background: url(img/musicon.gif) no-repeat;background-size:cover}

	#loading {position:absolute;left:0;top:0;z-index:50;width: 100%;height: 100%;background: #000}
	#loading .content1,#loading .content2 {position: absolute;left:50%;top:40%;margin-left:-20px;width: 40px;height: 40px}
	#loading .content1 div,#loading .content2 div {position: absolute;width: 12px;height: 12px;background: #fff;border-radius: 50%;-webkit-animation:loadingRun 1.5s infinite;animation:loadingRun 1.5s infinite;}
	#loading .content2 {-webkit-transform:rotate(45deg);transform:rotate(45deg)}
	#loading .arc1 {left: 0;top: 0}
	#loading .arc2 {right: 0;top: 0}
	#loading .arc3 {right: 0;bottom: 0}
	#loading .arc4 {left: 0;bottom: 0}
	@-webkit-keyframes loadingRun{
		0%{ -webkit-transform:scale(1);}
		50%{ -webkit-transform:scale(0);}
		100%{ -webkit-transform:scale(1);}
	}
	@keyframes loadingRun{
		0%{ transform:scale(1);}
		50%{ transform:scale(0);}
		100%{ transform:scale(1);}
	}
	#loading .content1 .arc1 {-webkit-animation-delay : -0.1s;}
	#loading .content2 .arc1 {-webkit-animation-delay : -0.3s;}
	#loading .content1 .arc2 {-webkit-animation-delay : -0.5s;}
	#loading .content2 .arc2 {-webkit-animation-delay : -0.7s;}
	#loading .content1 .arc3 {-webkit-animation-delay : -0.9s;}
	#loading .content2 .arc3 {-webkit-animation-delay : -1.1s;}
	#loading .content1 .arc4 {-webkit-animation-delay : -1.3s;}
	#loading .content2 .arc4 {-webkit-animation-delay : -1.5s;}
	#loading p {position:absolute;top:50%;width:100%;text-align:center;font-size: 30px;color: #fff;}
	</style>
	<script src="jquery-2.1.3.min.js"></script>
	<script type="text/javascript">
	$(document).on('touchmove',function(ev){
		ev.preventDefault();
	})
	$(function() {
		var $main = $('#main');
		var $list = $('#list');
		var $li = $list.find('>li');
		var viewHeight = $(window).height();
		$main.height(viewHeight);
		loading()
		
		slideCanvas();
		
		slideImg()
		
		function slideCanvas() {
			var $c1 = $('#c1');
			var gc = $c1.get(0).getContext('2d');
			$c1.attr('height',viewHeight);
			// $c1.height(viewHeight);
			var oImg = new Image();
			oImg.src = 'img/a.jpg';

			var oImg2 = new Image();
			oImg2.src = 'img/Touch4.png';
			var timer = null;
			var num = 0;
			oImg2.onload = function () {
				gc.drawImage(oImg,(640-viewWidth())/2,0,viewWidth(),viewHeight);
				gc.globalCompositeOperation = 'destination-out';
				$c1.on('touchstart',function() {
					timer = setInterval(function() {
						var i = num%4;
						var j = Math.floor(num/4); 
						gc.drawImage(oImg2, i*254, j*400, 254, 400,0,0,640,viewHeight);
						num++;
						if (num == 20) {
							clearInterval(timer);
							$c1.remove();
							cjAnimate.inAn(0)
						};
					},100)
					showMusic();
				})
				
			}
		}
		function beginEffect() {
			var $text1 = $('#text1');
			var $text2 = $('#text2');
			$text1.css('animation','1s infinite flash linear');
			$text1.on('webkitAnimationIteration animationIteration',function(ev) {
				if (ev.originalEvent.elapsedTime == 3) {
					$text1.remove();
					$text2.css('animation','1s infinite flash linear');
					$('#beginEffect').on('touchstart',function() {
						$(this).remove();
						$('#c1').trigger('touchstart')
					})
				}
			})

		}
		function slideImg() {
			var startY = 0;
			var nowIndex = 0;
			var prerornextIndex = 0;
			var step = 1/4;
			var oBtn = true;
			$li.on('touchstart',function(ev) {
				if (oBtn) {
					oBtn = false;
					var touch = ev.originalEvent.changedTouches[0];
					startY = touch.pageY;
					nowIndex = $(this).index();
					$li.on('touchend.li',function(ev) {
						var touch = ev.originalEvent.changedTouches[0];
						if (touch.pageY < startY) {  //↑
							prerornextIndex = nowIndex == $li.length-1 ? 0 : nowIndex + 1;
							$(this).css({'transform' : 'rotateX(90deg)','opacity' : 0, 'transition': '1s'}); 
							$li.eq(prerornextIndex)
							.css('transform','rotateX(-50deg)')
							.css('opacity',0);
						} else if (touch.pageY > startY) {  //↓
							prerornextIndex = nowIndex == 0 ? $li.length-1 : nowIndex - 1;
							$(this).css({'transform' : 'rotateX(-50deg)','opacity' : 0, 'transition': '1s'});

							$li.eq(prerornextIndex)
							.css('transform','rotateX(50deg)')
							.css('opacity',0);
							
						} else if(touch.pageY == startY) {
							bBtn = true;
							return
						}
						$li.eq(prerornextIndex).show()
						setTimeout(function() {
							$li.eq(prerornextIndex)
							.css({'transform' : 'rotateX(0)','transition' : '1s','opacity' : 1});
						},100)
						$('#arrow').find('span').html((prerornextIndex+1)+'/'+($li.length) );
						$li.off('.li')
					});
				};
			})
			$li.on('webkitTransitionEnd transitionEnd',function(ev) {
				if (!$li.is(ev.target)) {return};
				resetFn();
				if (cjAnimate.outAn(nowIndex)) {
					cjAnimate.outAn(nowIndex)
				};
				if (cjAnimate.inAn(prerornextIndex)) {
					cjAnimate.inAn(prerornextIndex)
				};
			})
			function resetFn() {
				$li.css({'transform' : ''});
				$li.css({'transition' : ''});
				$li.eq(prerornextIndex).attr('class','active').css('opacity',1).siblings().attr('class','').css('opacity' , 0);
				oBtn = true;
			}
		}
		function viewWidth() {
			var w = 640*viewHeight/960;
			w = w > 640 ? w : 640;
			return w;
		}
		var cjAnimate = {
			inAn : function(index) {
				var $img = $li.eq(index).find('img');
				setTimeout(function(){
					$img.eq(0).css({'transform' : 'scale(1)','transition' : '1s'});
					$img.eq(1).css({'transform' : 'translate(0,0)','transition' : '1s 0.5s','opacity' : 1});
					$img.eq(1).on('webkitTransitionEnd transitionEnd',function(){
						$img.eq(2).attr('class','active');
					});
					
				},100)
			},
			outAn : function(index) {
				var $img = $li.eq(index).find('img');
				$img.eq(0).css({'transform' : 'scale(1.5)','transition' : ''});
				$img.eq(1).css({'transform' : 'translate(0,200px)' , 'transition' : '','opacity' : 0});
				$img.eq(2).removeClass('active');
			}
		}
		$li.each(function(i,elem){
			cjAnimate.outAn(i);
		});
		function showMusic() {
			var bBtn = true;
			$('#music').on('touchstart',function() {
				if (bBtn) {
					$(this).attr('class','active');
					$('#a1').get(0).play();
				} else{
					$(this).removeClass('active');
					$('#a1').get(0).pause();
				}
				bBtn = !bBtn;
			});
			$('#music').trigger('touchstart');
		}
		function loading() {
			var arr = ['img3.jpg','img4.jpg','img5.jpg','img6.jpg','img7.jpg','img8.jpg','img9.jpg','img10.jpg','Touch4.png','text4.jpg','text5.jpg','text6.jpg','text7.jpg','text8.jpg'];
			var iNow = 0;
			$.each(arr,function(i,src) {
				var oImg = new Image();
				oImg.src = 'img/'+arr[i];
				oImg.onload = function() {
					iNow++;
					if (iNow == arr.length) {
						$('#loading').animate({'opacity' : 0},2000,function(){
							$(this).remove();
							beginEffect();
						})
					};
				}
				oImg.onerror = function() {
					$('#loading').animate({'opacity' : 0},2000,function(){	
						$(this).remove();
						beginEffect();
					})
				}
			})
		}
	})
	</script>
</head>
<body>
	<div id="main">
	<div id="loading">
		<div class="content1">
			<div class="arc1"></div>
			<div class="arc2"></div>
			<div class="arc3"></div>
			<div class="arc4"></div>
		</div>
		<div class="content2">
			<div class="arc1"></div>
			<div class="arc2"></div>
			<div class="arc3"></div>
			<div class="arc4"></div>
		</div>
		<p>我这里的天气晴朗，那你呢？</p>
	</div>
	<div id="beginEffect" >
		<div id="sun"></div>
		<div id="text1"></div>
		<div id="text2"></div>
		<div class="lx">
			<img src="img/lx.png">
		    <img src="img/lx.png">
		    <img src="img/lx.png">
		    <img src="img/lx.png">
		</div>
	</div>
	<canvas id="c1" width="640" height="960"></canvas>
		<ul id="list">
				<li>
			    	<img src="img/img3.jpg">
			        <img src="img/text3.jpg">
			        <img src="img/title3.png">
			    </li>
			    <li>
			    	<img src="img/img4.jpg">
			        <img src="img/text4.jpg">
			        <img src="img/title4.png">
			    </li>
			    <li>
			    	<img src="img/img5.jpg">
			        <img src="img/text5.jpg">
			        <img src="img/title5.png">
			    </li>
			    <li>
			    	<img src="img/img6.jpg">
			        <img src="img/text6.jpg">
			        <img src="img/title6.png">
			    </li>
			    <li>
			    	<img src="img/img7.jpg">
			        <img src="img/text7.jpg">
			        <img src="img/title7.png">
			    </li>
			    <li>
			    	<img src="img/img8.jpg">
			        <img src="img/text8.jpg">
			        <img src="img/title8.png">
			    </li>
			    <li>
			    	<img src="img/img9.jpg">
			        <img src="img/text9.jpg">
			        <img src="img/title9.png">
			    </li>
			    <li>
			    	<img src="img/img10.jpg">
			        <img src="img/text10.jpg">
			        <img src="img/title10.png">
			    </li>
		</ul>
		<div id="arrow">
			<div></div>
			<span>1/8</span>
		</div>
		<div id="music">
			<audio id="a1" src="img/music.mp3" preload="auto" loop></audio>
		</div>
	</div>
</body>
</html>